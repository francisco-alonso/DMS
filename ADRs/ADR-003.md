# ADR-003: Temporal Decision Strategy for Driver State Detection

**Status:** Accepted  
**Date:** 2025-12-14  
**Author:** Francisco Lopez  

---

## 1. Context

ADR-002 defines a local vision pipeline that processes camera frames into numerical features such as the Eye Aspect Ratio (EAR).

Each frame produces an instantaneous measurement (e.g. EAR = 0.22), but driver drowsiness is not an instantaneous phenomenon. It is a **temporal state** that emerges over time.

This ADR defines how feature values evolving across multiple frames are interpreted to determine driver state in a robust and explainable way.

---

## 2. Core Principle: Decisions Are Temporal

A single frame represents a snapshot in time and is insufficient to determine drowsiness.

Key observations:
- A normal blink causes a short EAR drop.
- Landmark detection may fail briefly.
- Drowsiness implies **sustained eye closure**.

Therefore, all decisions must be based on **sequences of frames**, not on individual frames.

---

## 3. Time, Frames, and Evaluation Frequency

The system processes frames as they arrive from the camera.

- Each frame has a timestamp.
- Frames arrive at a rate determined by the camera (e.g. ~30 FPS).
- **All temporal logic is evaluated only when a new frame arrives**.

There is no separate or continuous time-based polling.
Frames define the natural sampling rhythm of the system.

This means that any temporal strategy—whether frame-based or time-based—is updated once per frame.

---

## 4. Primary Strategy: Time-Based Consecutive Detection

The primary decision strategy for Phase 1 is based on **consecutive time below a threshold**.

### Description

- For each frame, compute EAR.
- If EAR is below a defined threshold, accumulate elapsed time.
- If EAR rises above the threshold, reset the accumulated time.
- If the accumulated time exceeds a defined duration, classify the state as DROWSY.

### Rationale

This strategy:
- Directly matches the human notion of “eyes staying closed”.
- Clearly distinguishes blinks (short interruptions) from sustained closure.
- Is easy to explain, debug, and reason about.

The duration threshold is **not fixed in this ADR** and will be refined empirically in later phases.

---

## 5. Sliding Window Concept (Secondary Strategy)

A sliding window is a moving interval that always contains **recent frames only**.

Example:
- Window duration: last 2 seconds.
- At each new frame, the window includes all frames whose timestamps fall within the last 2 seconds.
- Older frames automatically drop out as time progresses.

Importantly:
- The window is updated **once per frame**.
- The window moves forward continuously as frames arrive.
- There is no fixed “jump” or discrete block evaluation.

---

## 6. Sliding Window with Ratio: Interpretation and Limitations

A sliding window can be used to compute ratios, such as:
- the proportion of frames in the window where EAR is below a threshold.

This approach measures **how frequently** the eyes are closed within a recent interval, but **not whether closure is consecutive**.

As a result:
- Frequent blinking or intermittent long blinks may produce a high ratio.
- This does not necessarily indicate drowsiness.

For this reason:
- Sliding window ratios are **not suitable as the primary detector of drowsiness**.
- They may be useful as a secondary signal indicating fatigue or abnormal behavior.

---

## 7. Handling Noise and Missing Frames

- If no face is detected in a frame, that frame does not contribute to temporal accumulation.
- Brief detection losses should not immediately reset the system state.
- Conservative logic is preferred to minimize false positives.

These behaviors will be refined during implementation and testing.

---

## 8. Decision

For Phase 1:
- The primary decision mechanism is **time-based consecutive eye closure**.
- Sliding window–based ratios are considered optional secondary signals.
- Thresholds and durations are intentionally left undefined at this stage.

This approach prioritizes clarity, robustness, and explainability.

---

## 9. Next Steps

- Implement the primary time-based consecutive strategy.
- Collect real EAR data under normal and drowsy conditions.
- Refine thresholds based on empirical observation.
- Revisit this ADR if necessary once data is available.

---
